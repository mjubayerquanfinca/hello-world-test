# ğŸ” Role-Based Authentication API (Express + JWT)

This is a backend API built with **Node.js**, **Express**, and **JWT** that supports **role-based access control** with 3 user roles:  
`admin`, `manager`, and `user`.

## ğŸŒ Deployed Link

[https://stock-sales-management-backend.onrender.com](https://stock-sales-management-backend.onrender.com)

## âœ… Features

-   ğŸ” JWT-based Authentication
-   ğŸ”’ Protected Routes
-   ğŸ›‚ Role-Based Access Control
-   âœ… Middleware for token verification and role checks
-   ğŸ§© Modular route and middleware structure

## ğŸ—ï¸ Tech Stack

#### ğŸ“¦ Backend

-   **Node.js** â€“ JavaScript runtime environment
-   **Express.js** â€“ Web framework for Node.js
-   **MongoDB** â€“ NoSQL database
-   **Mongoose** â€“ MongoDB object modeling for Node.js

#### ğŸ” Authentication & Security

-   **bcryptjs** â€“ For password hashing
-   **jsonwebtoken (JWT)** â€“ For secure token-based authentication
-   **dotenv** â€“ For managing environment variables securely

#### ğŸ”§ Development Tools

-   **nodemon** â€“ For hot-reloading during development

## ğŸš€ Installation

```bash
git clone https://github.com/mehrabhossain1/stock-sales-management-backend
cd stock-sales-management-backend
npm install
```

## âš™ï¸ Environment Variables

Create a .env file in the root with the following:

```bash
PORT=5000
JWT_SECRET=your_jwt_secret
CONNECTION_STRING=your_mongodb_connection_string
```

## â–¶ï¸ Run the Server

```bash
npm run dev
```

## ğŸ“ Folder Structure

```bash
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ productController.js
â”‚   â””â”€â”€ saleController.js
â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ authMiddleware.js
â”‚   â””â”€â”€ roleMiddleware.js
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ Product.js
â”‚   â””â”€â”€ Sale.js
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ userRoutes.js
â”‚   â”œâ”€â”€ productRoutes.js
â”‚   â””â”€â”€ saleRoutes.js
â”œâ”€â”€ .env
â”œâ”€â”€ src/index.js
â””â”€â”€ package.json

```

## ğŸ”„ API Endpoints

| Method | Endpoint   | Roles Allowed              | Description             |
| ------ | ---------- | -------------------------- | ----------------------- |
| GET    | `/admin`   | `admin`                    | Only Admin can access   |
| GET    | `/manager` | `admin`, `manager`         | Admin or Manager access |
| GET    | `/user`    | `admin`, `manager`, `user` | All roles can access    |

### ğŸ“¦ Product Endpoints (`/api/products`) â€“ Admin Only

| Method | Endpoint            | Roles Allowed | Description      |
| ------ | ------------------- | ------------- | ---------------- |
| GET    | `/api/products`     | `admin`       | Get all products |
| POST   | `/api/products`     | `admin`       | Create product   |
| PUT    | `/api/products/:id` | `admin`       | Update product   |
| DELETE | `/api/products/:id` | `admin`       | Delete product   |

### ğŸ’¸ Sales Endpoints (`/api/sales`) â€“ Admin and Manager

| Method | Endpoint          | Roles Allowed      | Description                          |
| ------ | ----------------- | ------------------ | ------------------------------------ |
| POST   | `/api/sales`      | `admin`, `manager` | Record a sale                        |
| GET    | `/api/sales`      | `admin`, `manager` | Get all sales (role-based filtering) |
| GET    | `/api/sales/dues` | `admin`, `manager` | Get all due (unpaid) sales           |

## ğŸ›¡ï¸ Middleware Usage

âœ… `verifyToken`
Checks for a valid JWT in the request header.

âœ… `authorizeRoles(...allowedRoles)`
Restricts route access to users with specified roles.

ğŸ” Sales are linked to `product` and `soldBy` using Mongoose `.populate()`  
ğŸ“‰ Product stock is automatically reduced on each sale  
ğŸ§¾ Dues are calculated by `total - paid`

## ğŸ“¦ Example Request (using token)

```bash
GET /admin
Authorization: Bearer <your_token>
```

ğŸ“Œ Example: `authorizeRoles("admin")` protects routes only for admin users.

## ğŸ“„ License

This project is licensed under the MIT License.

## ğŸ™Œ Author

Made with â¤ï¸ by Meharab Hossan Munna
